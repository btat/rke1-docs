"use strict";(self.webpackChunkrke_docs=self.webpackChunkrke_docs||[]).push([[7951],{8555:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>a,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=s(5893),r=s(1151);const o={title:"Kubernetes Configuration Options",description:"There are a lot of different Kubernetes Configuration options you can choose from when setting up your cluster.yml for RKE"},t=void 0,l={id:"config-options/config-options",title:"Kubernetes Configuration Options",description:"There are a lot of different Kubernetes Configuration options you can choose from when setting up your cluster.yml for RKE",source:"@site/docs/config-options/config-options.md",sourceDirName:"config-options",slug:"/config-options/",permalink:"/config-options/",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher/rke1-docs/edit/main/docs/config-options/config-options.md",tags:[],version:"current",lastUpdatedAt:1707343823,formattedLastUpdatedAt:"Feb 7, 2024",frontMatter:{title:"Kubernetes Configuration Options",description:"There are a lot of different Kubernetes Configuration options you can choose from when setting up your cluster.yml for RKE"},sidebar:"mySidebar",previous:{title:"Adding and Removing Nodes",permalink:"/managing-clusters/"},next:{title:"Nodes",permalink:"/config-options/nodes/"}},d={},c=[{value:"Configuring Nodes",id:"configuring-nodes",level:3},{value:"Configuring Kubernetes Cluster",id:"configuring-kubernetes-cluster",level:3},{value:"Cluster Level Options",id:"cluster-level-options",level:2},{value:"Cluster Name",id:"cluster-name",level:3},{value:"Supported Docker Versions",id:"supported-docker-versions",level:3},{value:"Kubernetes Version",id:"kubernetes-version",level:3},{value:"Prefix Path",id:"prefix-path",level:3},{value:"Cluster Level SSH Key Path",id:"cluster-level-ssh-key-path",level:3},{value:"SSH Agent",id:"ssh-agent",level:3},{value:"Add-ons Job Timeout",id:"add-ons-job-timeout",level:3},{value:"cri-dockerd",id:"cri-dockerd",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["When setting up your ",(0,i.jsx)(n.code,{children:"cluster.yml"})," for RKE, there are a lot of different options that can be configured to control the behavior of how RKE launches Kubernetes."]}),"\n",(0,i.jsxs)(n.p,{children:["There are several options that can be configured in cluster configuration option. There are several ",(0,i.jsx)(n.a,{href:"/example-yamls/",children:"example yamls"})," that contain all the options."]}),"\n",(0,i.jsx)(n.h3,{id:"configuring-nodes",children:"Configuring Nodes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/nodes/",children:"Nodes"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#supported-docker-versions",children:"Ignoring unsupported Docker versions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/private-registries/",children:"Private Registries"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#cluster-level-ssh-key-path",children:"Cluster Level SSH Key Path"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#ssh-agent",children:"SSH Agent"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/bastion-host/",children:"Bastion Host"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuring-kubernetes-cluster",children:"Configuring Kubernetes Cluster"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#cluster-name",children:"Cluster Name"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#kubernetes-version",children:"Kubernetes Version"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#prefix-path",children:"Prefix Path"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/system-images/",children:"System Images"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/services/",children:"Services"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/services/services-extras/",children:"Extra Args and Binds and Environment Variables"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/services/external-etcd/",children:"External Etcd"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/authentication/",children:"Authentication"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/authorization/",children:"Authorization"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/rate-limiting/",children:"Rate Limiting"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/cloud-providers/",children:"Cloud Providers"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/audit-log/",children:"Audit Log"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/config-options/add-ons/",children:"Add-ons"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/add-ons/network-plugins/",children:"Network Plug-ins"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/add-ons/dns/",children:"DNS providers"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/add-ons/ingress-controllers/",children:"Ingress Controllers"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/add-ons/metrics-server/",children:"Metrics Server"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/config-options/add-ons/user-defined-add-ons/",children:"User-Defined Add-ons"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#add-ons-job-timeout",children:"Add-ons Job Timeout"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cluster-level-options",children:"Cluster Level Options"}),"\n",(0,i.jsx)(n.h3,{id:"cluster-name",children:"Cluster Name"}),"\n",(0,i.jsxs)(n.p,{children:["By default, the name of your cluster will be ",(0,i.jsx)(n.code,{children:"local"}),". If you want a different name, you would use the ",(0,i.jsx)(n.code,{children:"cluster_name"})," directive to change the name of your cluster. The name will be set in your cluster's generated kubeconfig file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"cluster_name: mycluster\n"})}),"\n",(0,i.jsx)(n.h3,{id:"supported-docker-versions",children:"Supported Docker Versions"}),"\n",(0,i.jsxs)(n.p,{children:["By default, RKE will check the installed Docker version on all hosts and fail with an error if the version is not supported by Kubernetes. The list of supported Docker versions is set specifically for each Kubernetes version in kontainer-driver-metadata depending on the RKE version used, as shown below. To override this behavior, set this option to ",(0,i.jsx)(n.code,{children:"true"}),". Refer to the following:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For RKE v1.3.x, see this ",(0,i.jsx)(n.a,{href:"https://github.com/rancher/kontainer-driver-metadata/blob/release-v2.6/rke/k8s_docker_info.go",children:"link"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For RKE v1.2.x, see this ",(0,i.jsx)(n.a,{href:"https://github.com/rancher/kontainer-driver-metadata/blob/release-v2.5/rke/k8s_docker_info.go",children:"link"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The default value is ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"ignore_docker_version: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-version",children:"Kubernetes Version"}),"\n",(0,i.jsxs)(n.p,{children:["For information on upgrading Kubernetes, refer to the ",(0,i.jsx)(n.a,{href:"/upgrades/",children:"upgrade section."})]}),"\n",(0,i.jsx)(n.p,{children:"Rolling back to previous Kubernetes versions is not supported."}),"\n",(0,i.jsx)(n.h3,{id:"prefix-path",children:"Prefix Path"}),"\n",(0,i.jsx)(n.p,{children:"For some operating systems including ROS, and CoreOS, RKE stores its resources to a different prefix path, this prefix path is by default for these operating systems is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/opt/rke\n"})}),"\n",(0,i.jsxs)(n.p,{children:["So ",(0,i.jsx)(n.code,{children:"/etc/kubernetes"})," will be stored in ",(0,i.jsx)(n.code,{children:"/opt/rke/etc/kubernetes"})," and ",(0,i.jsx)(n.code,{children:"/var/lib/etcd"})," will be stored in ",(0,i.jsx)(n.code,{children:"/opt/rke/var/lib/etcd"})," etc."]}),"\n",(0,i.jsxs)(n.p,{children:["To change the default prefix path for any cluster, you can use the following option in the cluster configuration file ",(0,i.jsx)(n.code,{children:"cluster.yml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"prefix_path: /opt/custom_path\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cluster-level-ssh-key-path",children:"Cluster Level SSH Key Path"}),"\n",(0,i.jsxs)(n.p,{children:["RKE connects to host(s) using ",(0,i.jsx)(n.code,{children:"ssh"}),". Typically, each node will have an independent path for each ssh key, i.e. ",(0,i.jsx)(n.code,{children:"ssh_key_path"}),", in the ",(0,i.jsx)(n.code,{children:"nodes"})," section, but if you have a SSH key that is able to access ",(0,i.jsx)(n.strong,{children:"all"})," hosts in your cluster configuration file, you can set the path to that ssh key at the top level. Otherwise, you would set the ssh key path in the ",(0,i.jsx)(n.a,{href:"/config-options/nodes/",children:"nodes"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"If ssh key paths are defined at the cluster level and at the node level, the node-level key will take precedence."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"ssh_key_path: ~/.ssh/test\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ssh-agent",children:"SSH Agent"}),"\n",(0,i.jsxs)(n.p,{children:["RKE supports using ssh connection configuration from a local ssh agent. The default value for this option is ",(0,i.jsx)(n.code,{children:"false"}),". If you want to set using a local ssh agent, you would set this to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"ssh_agent_auth: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you want to use an SSH private key with a passphrase, you will need to add your key to ",(0,i.jsx)(n.code,{children:"ssh-agent"})," and have the environment variable ",(0,i.jsx)(n.code,{children:"SSH_AUTH_SOCK"})," configured."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'$ eval "$(ssh-agent -s)"\nAgent pid 3975\n$ ssh-add /home/user/.ssh/id_rsa\nEnter passphrase for /home/user/.ssh/id_rsa:\nIdentity added: /home/user/.ssh/id_rsa (/home/user/.ssh/id_rsa)\n$ echo $SSH_AUTH_SOCK\n/tmp/ssh-118TMqxrXsEx/agent.3974\n'})}),"\n",(0,i.jsx)(n.h3,{id:"add-ons-job-timeout",children:"Add-ons Job Timeout"}),"\n",(0,i.jsxs)(n.p,{children:["You can define ",(0,i.jsx)(n.a,{href:"/config-options/add-ons/",children:"add-ons"})," to be deployed after the Kubernetes cluster comes up, which uses Kubernetes ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/",children:"jobs"}),". RKE will stop attempting to retrieve the job status after the timeout, which is in seconds. The default timeout value is ",(0,i.jsx)(n.code,{children:"30"})," seconds."]}),"\n",(0,i.jsx)(n.h3,{id:"cri-dockerd",children:"cri-dockerd"}),"\n",(0,i.jsxs)(n.p,{children:["Kubernetes will remove code in the kubelet that interacts with Docker (dockershim) in a future Kubernetes release. For more information, see ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/blog/2020/12/02/dockershim-faq/#when-will-dockershim-be-removed",children:"Dockershim Deprecation FAQ: When will dockershim be removed?"}),". The component that replaces this code is called ",(0,i.jsx)(n.code,{children:"cri-dockerd"})," and can be enabled using the following configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"enable_cri_dockerd: true\n"})})]})}function a(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>t});var i=s(7294);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);