<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-etcd-snapshots/restoring-from-backup/restoring-from-backup" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Restoring from Backup | RKE1</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rke.docs.rancher.com/etcd-snapshots/restoring-from-backup"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Restoring from Backup | RKE1"><meta data-rh="true" name="description" content="The details of restoring your cluster from backup are different depending on your version of RKE."><meta data-rh="true" property="og:description" content="The details of restoring your cluster from backup are different depending on your version of RKE."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rke.docs.rancher.com/etcd-snapshots/restoring-from-backup"><link data-rh="true" rel="alternate" href="https://rke.docs.rancher.com/etcd-snapshots/restoring-from-backup" hreflang="en"><link data-rh="true" rel="alternate" href="https://rke.docs.rancher.com/etcd-snapshots/restoring-from-backup" hreflang="x-default"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.d476b531.css">
<script src="/assets/js/runtime~main.0cf4d5b1.js" defer="defer"></script>
<script src="/assets/js/main.9b2ced8b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-horizontal-rke.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-horizontal-rke.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://github.com/rancher/rke" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/rancher/rke1-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://epinio.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__epinio">Epinio<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview of RKE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/os">Requirements</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/installation">RKE Kubernetes Installation</a><button aria-label="Expand sidebar category &#x27;RKE Kubernetes Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/upgrades">Upgrades</a><button aria-label="Expand sidebar category &#x27;Upgrades&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kubeconfig">Kubeconfig File</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/etcd-snapshots">Backups and Disaster Recovery</a><button aria-label="Collapse sidebar category &#x27;Backups and Disaster Recovery&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/etcd-snapshots/one-time-snapshots">One-time Snapshots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/etcd-snapshots/recurring-snapshots">Recurring Snapshots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/etcd-snapshots/restoring-from-backup">Restoring from Backup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/etcd-snapshots/example-scenarios">Example Scenarios</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/etcd-snapshots/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cert-mgmt">Certificate Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/managing-clusters">Adding and Removing Nodes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/config-options">Kubernetes Configuration Options</a><button aria-label="Expand sidebar category &#x27;Kubernetes Configuration Options&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/example-yamls">Example Cluster.ymls</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/etcd-snapshots"><span itemprop="name">Backups and Disaster Recovery</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Restoring from Backup</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Restoring from Backup</h1></header><p>The details of restoring your cluster from backup are different depending on your version of RKE.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">RKE v0.2.0+</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RKE before v0.2.0</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>If there is a disaster with your Kubernetes cluster, you can use <code>rke etcd snapshot-restore</code> to recover your etcd. This command reverts etcd to a specific snapshot and should be run on an etcd node of the the specific cluster that has suffered the disaster.</p><p>The following actions will be performed when you run the command:</p><ul>
<li>Syncs the snapshot or downloads the snapshot from S3, if necessary.</li>
<li>Checks snapshot checksum across etcd nodes to make sure they are identical.</li>
<li>Deletes your current cluster and cleans old data by running <code>rke remove</code>. This removes the entire Kubernetes cluster, not just the etcd cluster.</li>
<li>Rebuilds the etcd cluster from the chosen snapshot.</li>
<li>Creates a new cluster by running <code>rke up</code>.</li>
<li>Restarts cluster system pods.</li>
</ul><div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>You should back up any important data in your cluster before running <code>rke etcd snapshot-restore</code> because the command deletes your current Kubernetes cluster and replaces it with a new one.</p></div></div><p>The snapshot used to restore your etcd cluster can either be stored locally in <code>/opt/rke/etcd-snapshots</code> or from a S3 compatible backend.</p><p><em>Available as of v1.1.4</em></p><p>If the snapshot contains the cluster state file, it will automatically be extracted and used for the restore. If you want to force the use of the local state file, you can add <code>--use-local-state</code> to the command. If the snapshot was created using an RKE version before v1.1.4, or if the snapshot does not contain a state file, make sure the cluster state file (by default available as <code>cluster.rkestate</code>) is present before executing the command.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-restoring-from-a-local-snapshot">Example of Restoring from a Local Snapshot<a href="#example-of-restoring-from-a-local-snapshot" class="hash-link" aria-label="Direct link to Example of Restoring from a Local Snapshot" title="Direct link to Example of Restoring from a Local Snapshot">​</a></h3><p>To restore etcd from a local snapshot, run:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ rke etcd snapshot-restore --config cluster.yml --name mysnapshot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The snapshot is assumed to be located in <code>/opt/rke/etcd-snapshots</code>.</p><p><strong>Note:</strong> The <code>pki.bundle.tar.gz</code> file is not needed because RKE v0.2.0 changed how the <a href="/installation#kubernetes-cluster-state">Kubernetes cluster state is stored</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-restoring-from-a-snapshot-in-s3">Example of Restoring from a Snapshot in S3<a href="#example-of-restoring-from-a-snapshot-in-s3" class="hash-link" aria-label="Direct link to Example of Restoring from a Snapshot in S3" title="Direct link to Example of Restoring from a Snapshot in S3">​</a></h3><p>When restoring etcd from a snapshot located in S3, the command needs the S3 information in order to connect to the S3 backend and retrieve the snapshot.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ rke etcd snapshot-restore \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--config cluster.yml \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--name snapshot-name \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--s3 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--access-key S3_ACCESS_KEY \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--secret-key S3_SECRET_KEY \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--bucket-name s3-bucket-name \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--folder s3-folder-name \ # Optional - Available as of v0.3.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--s3-endpoint s3.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> if you were restoring a cluster that had Rancher installed, the Rancher UI should start up after a few minutes; you don&#x27;t need to re-run Helm.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="options-for-rke-etcd-snapshot-restore">Options for <code>rke etcd snapshot-restore</code><a href="#options-for-rke-etcd-snapshot-restore" class="hash-link" aria-label="Direct link to options-for-rke-etcd-snapshot-restore" title="Direct link to options-for-rke-etcd-snapshot-restore">​</a></h3><table><thead><tr><th>Option</th><th>Description</th><th>S3 Specific</th></tr></thead><tbody><tr><td><code>--name</code> value</td><td>Specify snapshot name</td><td></td></tr><tr><td><code>--config</code> value</td><td>Specify an alternate cluster YAML file (default: <code>cluster.yml</code>) [$RKE_CONFIG]</td><td></td></tr><tr><td><code>--use-local-state</code></td><td>Force the use of the local state file instead of looking for a state file in the snapshot <em>Available as of v1.1.4</em></td><td></td></tr><tr><td><code>--s3</code></td><td>Enabled backup to s3</td><td>*</td></tr><tr><td><code>--s3-endpoint</code> value</td><td>Specify s3 endpoint url (default: &quot;s3.amazonaws.com&quot;)</td><td>*</td></tr><tr><td><code>--access-key</code> value</td><td>Specify s3 accessKey</td><td>*</td></tr><tr><td><code>--secret-key</code> value</td><td>Specify s3 secretKey</td><td>*</td></tr><tr><td><code>--bucket-name</code> value</td><td>Specify s3 bucket name</td><td>*</td></tr><tr><td><code>--folder</code> value</td><td>Specify folder inside  bucket where backup will be stored. This is optional.  This is optional. <em>Available as of v0.3.0</em></td><td>*</td></tr><tr><td><code>--region</code> value</td><td>Specify the s3 bucket location (optional)</td><td>*</td></tr><tr><td><code>--ssh-agent-auth</code></td><td><a href="/config-options#ssh-agent">Use SSH Agent Auth defined by SSH_AUTH_SOCK</a></td><td></td></tr><tr><td><code>--ignore-docker-version</code></td><td><a href="/config-options#supported-docker-versions">Disable Docker version check</a></td><td></td></tr></tbody></table></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>If there is a disaster with your Kubernetes cluster, you can use <code>rke etcd snapshot-restore</code> to recover your etcd. This command reverts etcd to a specific snapshot and should be run on an etcd node of the the specific cluster that has suffered the disaster.</p><p>The following actions will be performed when you run the command:</p><ul>
<li>Removes the old etcd cluster</li>
<li>Rebuilds the etcd cluster using the local snapshot</li>
</ul><p>Before you run this command, you must:</p><ul>
<li>Run <code>rke remove</code> to remove your Kubernetes cluster and clean the nodes</li>
<li>Download your etcd snapshot from S3, if applicable. Place the etcd snapshot and the <code>pki.bundle.tar.gz</code> file in <code>/opt/rke/etcd-snapshots</code>. Manually sync the snapshot across all <code>etcd</code> nodes.</li>
</ul><p>After the restore, you must rebuild your Kubernetes cluster with <code>rke up</code>.</p><div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>You should back up any important data in your cluster before running <code>rke etcd snapshot-restore</code> because the command deletes your current etcd cluster and replaces it with a new one.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-restoring-from-a-local-snapshot-1">Example of Restoring from a Local Snapshot<a href="#example-of-restoring-from-a-local-snapshot-1" class="hash-link" aria-label="Direct link to Example of Restoring from a Local Snapshot" title="Direct link to Example of Restoring from a Local Snapshot">​</a></h3><p>To restore etcd from a local snapshot, run:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ rke etcd snapshot-restore --config cluster.yml --name mysnapshot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The snapshot is assumed to be located in <code>/opt/rke/etcd-snapshots</code>.</p><p>The snapshot must be manually synched across all <code>etcd</code> nodes.</p><p>The <code>pki.bundle.tar.gz</code> file is also expected to be in the same location.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="options-for-rke-etcd-snapshot-restore-1">Options for <code>rke etcd snapshot-restore</code><a href="#options-for-rke-etcd-snapshot-restore-1" class="hash-link" aria-label="Direct link to options-for-rke-etcd-snapshot-restore-1" title="Direct link to options-for-rke-etcd-snapshot-restore-1">​</a></h3><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>--name</code> value</td><td>Specify snapshot name</td></tr><tr><td><code>--config</code> value</td><td>Specify an alternate cluster YAML file (default: <code>cluster.yml</code>) [$RKE_CONFIG]</td></tr><tr><td><code>--ssh-agent-auth</code></td><td><a href="/config-options#ssh-agent">Use SSH Agent Auth defined by SSH_AUTH_SOCK</a></td></tr><tr><td><code>--ignore-docker-version</code></td><td><a href="/config-options#supported-docker-versions">Disable Docker version check</a></td></tr></tbody></table></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rke1-docs/edit/main/docs/etcd-snapshots/restoring-from-backup/restoring-from-backup.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-02-07T22:10:23.000Z">Feb 7, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/etcd-snapshots/recurring-snapshots"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Recurring Snapshots</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/etcd-snapshots/example-scenarios"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Example Scenarios</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example-of-restoring-from-a-local-snapshot" class="table-of-contents__link toc-highlight">Example of Restoring from a Local Snapshot</a></li><li><a href="#example-of-restoring-from-a-snapshot-in-s3" class="table-of-contents__link toc-highlight">Example of Restoring from a Snapshot in S3</a></li><li><a href="#options-for-rke-etcd-snapshot-restore" class="table-of-contents__link toc-highlight">Options for <code>rke etcd snapshot-restore</code></a></li><li><a href="#example-of-restoring-from-a-local-snapshot-1" class="table-of-contents__link toc-highlight">Example of Restoring from a Local Snapshot</a></li><li><a href="#options-for-rke-etcd-snapshot-restore-1" class="table-of-contents__link toc-highlight">Options for <code>rke etcd snapshot-restore</code></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>