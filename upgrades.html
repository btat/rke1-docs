<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-upgrades/upgrades" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Upgrades | RKE1 Enterprise</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rke.docs.rancher.com/upgrades"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgrades | RKE1 Enterprise"><meta data-rh="true" name="description" content="After RKE has deployed Kubernetes, you can upgrade the versions of the components in your Kubernetes cluster, the definition of the Kubernetes services or the add-ons."><meta data-rh="true" property="og:description" content="After RKE has deployed Kubernetes, you can upgrade the versions of the components in your Kubernetes cluster, the definition of the Kubernetes services or the add-ons."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rke.docs.rancher.com/upgrades"><link data-rh="true" rel="alternate" href="https://rke.docs.rancher.com/upgrades" hreflang="en"><link data-rh="true" rel="alternate" href="https://rke.docs.rancher.com/upgrades" hreflang="x-default"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.d476b531.css">
<script src="/assets/js/runtime~main.0cf4d5b1.js" defer="defer"></script>
<script src="/assets/js/main.d535c39c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-horizontal-rke.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-horizontal-rke.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://github.com/rancher/rke" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/rancher/rke1-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://epinio.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__epinio">Epinio<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview of RKE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/os">Requirements</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/installation">RKE Kubernetes Installation</a><button aria-label="Expand sidebar category &#x27;RKE Kubernetes Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" href="/upgrades">Upgrades</a><button aria-label="Collapse sidebar category &#x27;Upgrades&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/upgrades/how-upgrades-work">How Upgrades Work</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/upgrades/maintaining-availability">Maintaining Availability for Applications During Upgrades</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/upgrades/configuring-strategy">Configuring the Upgrade Strategy</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kubeconfig">Kubeconfig File</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/etcd-snapshots">Backups and Disaster Recovery</a><button aria-label="Expand sidebar category &#x27;Backups and Disaster Recovery&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cert-mgmt">Certificate Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/managing-clusters">Adding and Removing Nodes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/config-options">Kubernetes Configuration Options</a><button aria-label="Expand sidebar category &#x27;Kubernetes Configuration Options&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/example-yamls">Example Cluster.ymls</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Upgrades</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrades</h1></header><p>After RKE has deployed Kubernetes, you can upgrade the versions of the components in your Kubernetes cluster, the <a href="/config-options/services">definition of the Kubernetes services</a> or the <a href="/config-options/add-ons">add-ons</a>.</p>
<p>The default Kubernetes version for each RKE version can be found in the release notes accompanying <a href="https://github.com/rancher/rke/releases/" target="_blank" rel="noopener noreferrer">the RKE download</a>. These can also be checked with the <a href="#listing-supported-kubernetes-versions">rke CLI</a></p>
<p>You can also select a newer version of Kubernetes to install for your cluster but please avoid skipping minor versions, as this can increase the chances of an issue due to accumulated changes, as per the <a href="https://kubernetes.io/releases/version-skew-policy/" target="_blank" rel="noopener noreferrer">upstream Kubernetes documentation</a></p>
<p>In case the Kubernetes version is defined in the <code>kubernetes_version</code> directive and under the <code>system-images</code> directive, the <code>system-images</code> configuration will take precedence over the <code>kubernetes_version</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-upgrades-work">How Upgrades Work<a href="#how-upgrades-work" class="hash-link" aria-label="Direct link to How Upgrades Work" title="Direct link to How Upgrades Work">​</a></h3>
<p>In <a href="/upgrades/how-upgrades-work">this section,</a> you&#x27;ll learn what happens when you edit or upgrade your RKE Kubernetes cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<ul>
<li>Ensure that any <code>system_images</code> configuration is absent from the <code>cluster.yml</code>. The Kubernetes version should only be listed under the <code>system_images</code> directive if an <a href="#using-an-unsupported-kubernetes-version">unsupported version</a> is being used. Refer to <a href="#kubernetes-version-precedence">Kubernetes version precedence</a> for more information.</li>
<li>Ensure that the correct files to manage <a href="/installation#kubernetes-cluster-state">Kubernetes cluster state</a> are present in the working directory. Refer to the tabs below for the required files, which differ based on the RKE version.</li>
</ul>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">RKE v0.2.0+</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RKE before v0.2.0</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>The <code>cluster.rkestate</code> file contains the current state of the cluster including the RKE configuration and the certificates.</p><p>This file is created in the same directory that has the cluster configuration file <code>cluster.yml</code>.</p><p>It is required to keep the <code>cluster.rkestate</code> file to perform any operation on the cluster through RKE, or when upgrading a cluster last managed via RKE v0.2.0 or later.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Ensure that the <code>kube_config_cluster.yml</code> file is present in the working directory.</p><p>RKE saves the Kubernetes cluster state as a secret. When updating the state, RKE pulls the secret, updates or changes the state, and saves a new secret. The <code>kube_config_cluster.yml</code> file is required for upgrading a cluster last managed via RKE v0.1.x.</p></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-kubernetes">Upgrading Kubernetes<a href="#upgrading-kubernetes" class="hash-link" aria-label="Direct link to Upgrading Kubernetes" title="Direct link to Upgrading Kubernetes">​</a></h3>
<p>To upgrade the Kubernetes version of an RKE-provisioned cluster, set the <code>kubernetes_version</code> string in the <code>cluster.yml</code> to the desired version from the <a href="#listing-supported-kubernetes-versions">list of supported Kubernetes versions</a> for the specific version of RKE:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">kubernetes_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v1.15.5-rancher1-1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then invoke <code>rke up</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ rke up --config cluster.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-upgrade-strategy">Configuring the Upgrade Strategy<a href="#configuring-the-upgrade-strategy" class="hash-link" aria-label="Direct link to Configuring the Upgrade Strategy" title="Direct link to Configuring the Upgrade Strategy">​</a></h3>
<p>As of v0.1.8, upgrades to add-ons are supported. <a href="/config-options/add-ons">Add-ons</a> can also be upgraded by changing any of the add-ons and running <code>rke up</code> again with the updated configuration file.</p>
<p>As of v1.1.0, additional upgrade options became available to give you more granular control over the upgrade process. These options can be used to maintain availability of your applications during a cluster upgrade.</p>
<p>For details on upgrade configuration options, refer to <a href="/upgrades/configuring-strategy">Configuring the Upgrade Strategy.</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="maintaining-availability-for-applications-during-upgrades">Maintaining Availability for Applications During Upgrades<a href="#maintaining-availability-for-applications-during-upgrades" class="hash-link" aria-label="Direct link to Maintaining Availability for Applications During Upgrades" title="Direct link to Maintaining Availability for Applications During Upgrades">​</a></h3>
<p>In <a href="/upgrades/maintaining-availability">this section,</a> you&#x27;ll learn the requirements to prevent downtime for your applications when you upgrade the cluster using <code>rke up</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="listing-supported-kubernetes-versions">Listing Supported Kubernetes Versions<a href="#listing-supported-kubernetes-versions" class="hash-link" aria-label="Direct link to Listing Supported Kubernetes Versions" title="Direct link to Listing Supported Kubernetes Versions">​</a></h3>
<p>Please refer to the <a href="https://github.com/rancher/rke/releases" target="_blank" rel="noopener noreferrer">release notes</a> of the RKE version that you are running, to find the list of supported Kubernetes versions as well as the default Kubernetes version. Note: RKE v1.x should be used.</p>
<p>You can also list the supported versions and system images of specific version of RKE release with a quick command.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ rke config --list-version --all</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">v1.15.3-rancher2-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">v1.13.10-rancher1-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">v1.14.6-rancher2-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">v1.16.0-beta.1-rancher1-1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-version-precedence">Kubernetes Version Precedence<a href="#kubernetes-version-precedence" class="hash-link" aria-label="Direct link to Kubernetes Version Precedence" title="Direct link to Kubernetes Version Precedence">​</a></h3>
<p>In case both <code>kubernetes_version</code> and <code>system_images</code> are defined, the <code>system_images</code> configuration will take precedence over <code>kubernetes_version</code>.</p>
<p>In addition, if neither <code>kubernetes_version</code> nor <code>system_images</code> are configured in the <code>cluster.yml</code>, RKE will apply the default Kubernetes version for the specific version of RKE used to invoke <code>rke up</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-an-unsupported-kubernetes-version">Using an Unsupported Kubernetes Version<a href="#using-an-unsupported-kubernetes-version" class="hash-link" aria-label="Direct link to Using an Unsupported Kubernetes Version" title="Direct link to Using an Unsupported Kubernetes Version">​</a></h3>
<p>As of v0.2.0, if a version is defined in <code>kubernetes_version</code> and is not found in the specific list of supported Kubernetes versions, then RKE will error out.</p>
<p>Before v0.2.0, if a version is defined in <code>kubernetes_version</code> and is not found in the specific list of supported Kubernetes versions,  the default version from the supported list is used.</p>
<p>If you want to use a different version from the supported list, please use the <a href="/config-options/system-images">system images</a> option.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapping-the-kubernetes-version-to-services">Mapping the Kubernetes Version to Services<a href="#mapping-the-kubernetes-version-to-services" class="hash-link" aria-label="Direct link to Mapping the Kubernetes Version to Services" title="Direct link to Mapping the Kubernetes Version to Services">​</a></h3>
<p>In RKE, <code>kubernetes_version</code> is used to map the version of Kubernetes to the default services, parameters, and options.</p>
<p>For RKE v0.3.0+, the service defaults are located <a href="https://github.com/rancher/kontainer-driver-metadata/blob/master/rke/k8s_service_options.go" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>For RKE before v0.3.0, the service defaults are located <a href="https://github.com/rancher/types/blob/release/v2.2/apis/management.cattle.io/v3/k8s_defaults.go" target="_blank" rel="noopener noreferrer">here</a>. Note: The version in the path of the service defaults file corresponds to a Rancher version. Therefore, for Rancher v2.1.x, <a href="https://github.com/rancher/types/blob/release/v2.1/apis/management.cattle.io/v3/k8s_defaults.go" target="_blank" rel="noopener noreferrer">this file</a> should be used.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-upgrades">Service Upgrades<a href="#service-upgrades" class="hash-link" aria-label="Direct link to Service Upgrades" title="Direct link to Service Upgrades">​</a></h3>
<p><a href="/config-options/services">Services</a> can be upgraded by changing any of the services arguments or <code>extra_args</code> and running <code>rke up</code> again with the updated configuration file.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The following arguments, <code>service_cluster_ip_range</code> or <code>cluster_cidr</code>, cannot be changed as any changes to these arguments will result in a broken cluster. Currently, network pods are not automatically upgraded.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-nodes-manually">Upgrading Nodes Manually<a href="#upgrading-nodes-manually" class="hash-link" aria-label="Direct link to Upgrading Nodes Manually" title="Direct link to Upgrading Nodes Manually">​</a></h3>
<p><em>Available as of v1.1.0</em></p>
<p>You can manually update each type of node separately. As a best practice, upgrade the etcd nodes first, followed by controlplane and then worker nodes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rolling-back-the-kubernetes-version">Rolling Back the Kubernetes Version<a href="#rolling-back-the-kubernetes-version" class="hash-link" aria-label="Direct link to Rolling Back the Kubernetes Version" title="Direct link to Rolling Back the Kubernetes Version">​</a></h3>
<p><em>Available as of v1.1.0</em></p>
<p>A cluster can be restored back to a snapshot that uses a previous Kubernetes version.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3>
<p><em>Applies to v1.1.0+</em></p>
<p>If a node doesn&#x27;t come up after an upgrade, the <code>rke up</code> command errors out.</p>
<p>No upgrade will proceed if the number of unavailable nodes exceeds the configured maximum.</p>
<p>If an upgrade stops, you may need to fix an unavailable node or remove it from the cluster before the upgrade can continue.</p>
<p>A failed node could be in many different states:</p>
<ul>
<li>Powered off</li>
<li>Unavailable</li>
<li>User drains a node while upgrade is in process, so there are no kubelets on the node</li>
<li>The upgrade itself failed</li>
</ul>
<p>Some expected failure scenarios include the following:</p>
<ul>
<li>If the maximum unavailable number of nodes is reached during an upgrade, the RKE CLI will error out and exit the CLI with a failure code.</li>
<li>If some nodes fail to upgrade, but the number of failed nodes doesn&#x27;t reach the maximum unavailable number of nodes, the RKE CLI logs the nodes that were unable to upgrade and continues to upgrade the add-ons. After the add-ons are upgraded, RKE will error out and exit the CLI with a failure code regardless of add-on upgrade status.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rke1-docs/edit/main/docs/upgrades/upgrades.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-02-07T22:10:23.000Z">Feb 7, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/installation/certs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Certificates</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/upgrades/how-upgrades-work"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How Upgrades Work</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-upgrades-work" class="table-of-contents__link toc-highlight">How Upgrades Work</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#upgrading-kubernetes" class="table-of-contents__link toc-highlight">Upgrading Kubernetes</a></li><li><a href="#configuring-the-upgrade-strategy" class="table-of-contents__link toc-highlight">Configuring the Upgrade Strategy</a></li><li><a href="#maintaining-availability-for-applications-during-upgrades" class="table-of-contents__link toc-highlight">Maintaining Availability for Applications During Upgrades</a></li><li><a href="#listing-supported-kubernetes-versions" class="table-of-contents__link toc-highlight">Listing Supported Kubernetes Versions</a></li><li><a href="#kubernetes-version-precedence" class="table-of-contents__link toc-highlight">Kubernetes Version Precedence</a></li><li><a href="#using-an-unsupported-kubernetes-version" class="table-of-contents__link toc-highlight">Using an Unsupported Kubernetes Version</a></li><li><a href="#mapping-the-kubernetes-version-to-services" class="table-of-contents__link toc-highlight">Mapping the Kubernetes Version to Services</a></li><li><a href="#service-upgrades" class="table-of-contents__link toc-highlight">Service Upgrades</a></li><li><a href="#upgrading-nodes-manually" class="table-of-contents__link toc-highlight">Upgrading Nodes Manually</a></li><li><a href="#rolling-back-the-kubernetes-version" class="table-of-contents__link toc-highlight">Rolling Back the Kubernetes Version</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>